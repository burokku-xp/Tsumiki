# スコープ定義ガイドライン

## 基本原則

change proposalを作成する際は、実装スコープを明確に定義することが重要。以下の原則に従う：

1. **機能ごとに分離**: 各change proposalは1つの機能に焦点を当て、他の機能への影響を最小化
2. **スコープの明確化**: スコープ外のファイルには手を付けない
3. **必要な連携の確認**: 機能間の連携が必要な箇所は確認の上で含める
4. **影響範囲の最小化**: 変更の影響範囲を可能な限り小さく保つ

## スコープ定義の手順

### 1. 機能の特定

プランの内容から、実装する機能を特定する：

**例**: "基盤セットアップ"機能
- 拡張機能の基本構造
- ビルド環境
- アクティベーション処理
- 基本的なコマンド登録

### 2. 関連ファイルの洗い出し

機能に関連するファイルを洗い出す：

**例**: 基盤セットアップの場合
- `package.json` - 拡張機能マニフェスト
- `tsconfig.json` - TypeScript設定
- `esbuild.config.js` - ビルド設定
- `src/extension.ts` - アクティベーション処理
- `src/commands/` - コマンド登録

### 3. 影響範囲の確認

各ファイルが他の機能に影響を与えるか確認：

**確認項目**:
- 他の機能が依存しているか
- 共通の設定ファイルか
- 既存の機能と競合するか

**例**: `package.json`は共通ファイルだが、基盤セットアップでは拡張機能の基本設定のみを追加

### 4. 連携箇所の特定

機能間の連携が必要な箇所を特定：

**確認項目**:
- データベース接続が必要か
- 他の機能のAPIを呼び出すか
- 共通のユーティリティを使用するか

**例**: データ永続化機能は、基盤セットアップで定義されたコマンドを使用する可能性がある

### 5. スコープ定義の文書化

proposal.mdにスコープ定義を明記：

```markdown
## 実装スコープ

### 含まれるファイル
- `package.json` - 拡張機能マニフェストの基本設定
- `tsconfig.json` - TypeScript設定
- `esbuild.config.js` - ビルド設定
- `src/extension.ts` - アクティベーション処理
- `src/commands/` - 基本的なコマンド登録

### スコープ外のファイル
- `src/database/` - データ永続化機能（別のchange proposalで実装）
- `src/measurement/` - 計測機能（別のchange proposalで実装）
- `src/display/` - 表示機能（別のchange proposalで実装）

### 連携箇所
- なし（基盤セットアップは独立した機能）
```

## 機能分離の例

### 例1: 基盤セットアップ（add-foundation-setup）

**スコープ**:
- 拡張機能の基本構造
- ビルド環境
- アクティベーション処理
- 基本的なコマンド登録

**含まれるファイル**:
- `package.json`
- `tsconfig.json`
- `esbuild.config.js`
- `src/extension.ts`
- `src/commands/`

**スコープ外**:
- データベース関連
- 計測機能
- 表示機能
- Slack連携

### 例2: データ永続化（add-data-persistence）

**スコープ**:
- SQLiteデータベースの初期化
- データモデル定義
- データベース操作の抽象化レイヤー

**含まれるファイル**:
- `src/database/`
- `src/database/models/`
- `src/database/migrations/`

**スコープ外**:
- 計測機能（データベースを使用するが、このchange proposalでは実装しない）
- 表示機能
- Slack連携

**連携箇所**:
- `src/extension.ts` - データベースの初期化をアクティベーション時に実行（必要に応じて）

### 例3: 計測機能（add-measurement-features）

**スコープ**:
- 作業時間計測
- 保存回数カウント
- 編集ファイル追跡
- 変更行数計算
- 言語比率集計

**含まれるファイル**:
- `src/measurement/`
- `src/measurement/timer.ts`
- `src/measurement/counters.ts`
- `src/measurement/trackers.ts`

**スコープ外**:
- 表示機能（計測データを表示するが、このchange proposalでは実装しない）
- Slack連携

**連携箇所**:
- `src/database/` - 計測データをデータベースに保存（データ永続化機能を使用）
- `src/extension.ts` - VSCodeイベントの登録（必要に応じて）

## スコープ外ファイルの扱い

スコープ定義に含まれていないファイルは、以下の場合でも変更しない：

### 変更してはいけない場合

- 他の機能が依存しているファイル
- 共通の設定ファイル（変更が他の機能に影響する）
- 既存の機能と競合する可能性があるファイル

### 確認が必要な場合

- 連携箇所として必要だが、スコープ定義に含まれていない
- この場合は、スコープ定義を更新してから変更

## スコープ定義の確認チェックリスト

proposal作成時、以下のチェックリストでスコープ定義を確認：

- [ ] 機能が明確に定義されているか
- [ ] 関連ファイルがすべて洗い出されているか
- [ ] スコープ外のファイルが明確に定義されているか
- [ ] 連携箇所が確認されているか
- [ ] 影響範囲が最小限に抑えられているか
- [ ] proposal.mdにスコープ定義が明記されているか

## トラブルシューティング

### スコープが広すぎる場合

機能が大きすぎて、1つのchange proposalに収まらない場合：

1. 機能をさらに細分化
2. 複数のchange proposalに分割
3. 依存関係を明確にする

### 連携箇所が不明確な場合

機能間の連携が必要だが、どのファイルを変更すべきか不明確な場合：

1. 既存の機能を確認
2. 連携箇所を特定
3. スコープ定義を更新
4. ユーザーに確認

### スコープ外のファイルを変更する必要がある場合

実装中に、スコープ外のファイルを変更する必要が生じた場合：

1. 変更の理由を確認
2. スコープ定義を更新
3. ユーザーに確認
4. 承認後に変更
