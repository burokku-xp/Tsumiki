# Design: Measurement Features

## Context

VSCode APIのイベントを活用して、開発者の作業量を自動的に計測します。作業時間、保存回数、ファイル編集、行数、言語比率を計測し、データベースに保存します。

## Goals / Non-Goals

### Goals
- 自動的な計測（ユーザー操作を最小限に）
- 正確な行数計算（空行・コメント除外）
- 連打防止（保存時のみカウント）
- リアルタイムなデータ収集

### Non-Goals
- コード内容の送信（統計のみ）
- Git連携（v1では除外）
- ポモドーロタイマー（v2以降）

## Decisions

### Decision: 保存時のみ行数をカウント
- **理由**: 連打防止、パフォーマンス向上
- **代替案**: リアルタイムカウント（パフォーマンス低下のリスク）

### Decision: 空行・コメントを除外
- **理由**: 実質的なコード変更量を反映
- **実装方法**: 言語別のコメントパターンマッチング、空行の検出

### Decision: 拡張子ベースの言語判定
- **理由**: シンプルで高速、十分な精度
- **代替案**: ファイル内容解析（複雑、遅い）

### Decision: タイマーは手動開始/停止
- **理由**: ユーザーが作業開始/終了を明示的に制御
- **代替案**: 自動検出（誤検出のリスク）

## Risks / Trade-offs

- **リスク**: 大量ファイル編集時のパフォーマンス低下
- **対策**: 非同期処理、バッチ処理、デバウンス

- **リスク**: 行数計算の不正確性（コメントパターンの漏れ）
- **対策**: 主要言語のコメントパターンを網羅、テスト

- **リスク**: タイマーの誤操作（開始忘れ、停止忘れ）
- **対策**: UIでの状態表示、自動停止機能（将来実装）

## Migration Plan

新規機能のため、マイグレーションは不要です。

## Open Questions

- コメント除外の精度をどの程度まで追求するか（主要言語のみ vs 全言語対応）
